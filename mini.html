<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mini Crossword</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-top: 20px;
      padding: 70px;
      position: relative; /* Positioning context for number overlay */
    }
    .topbar {
        width: 100%;
        background: #ffffff;
        border-bottom: 1px solid #e5e7eb;
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 8px 12px;
        position: fixed;
        top: 0;
        left: 0;
        z-index: 1000;
      }
      
      .topbar-icon {
        height: 40px;
        width: 145px;
        cursor: pointer;
      }

    .gear-container {
      position: relative;
      display: flex;
      align-items: center;
      padding: 0px 75px 0px 0px;
    }

    .gear {
      cursor: pointer;
    }

    .gear img {
      width: 20px;
      height: 20px;
    }

    .dropdown {
      display: none;
      position: absolute;
      right: 0;
      top: calc(100% + 4px);
      background: white;
      border-radius: 8px;
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
      border: 1px solid rgba(0, 0, 0, 0.05);
      min-width: 130px;
      z-index: 10;
      overflow: hidden;
    }

    .dropdown div {
      padding: 12px 16px;
      cursor: pointer;
      font-size: 14px;
      color: #000;
      transition: background-color 0.15s ease-in-out;
    }

    .dropdown div:hover {
      background: rgba(0, 0, 0, 0.05);
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(5, 60px);
      grid-template-rows: repeat(6, 60px);
      border: 0px solid black;
    }

    .cell {
      width: 60px;
      height: 60px;
      background: white;
      border: none;
      position: relative;
      font-size: 26px;
      font-weight: 500;
      text-align: center;
      line-height: 60px;
      cursor: pointer;
      user-select: none;
    }

    input.cell {
      text-transform: uppercase;
      font-size: 26px;
      font-weight: 500;
      text-align: center;
      padding: 0;
      margin: 0;
      border: none;
      caret-color: transparent;
      -webkit-appearance: none;
      -webkit-border-radius: 0;
      border-radius: 0;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
    }

    input.cell:focus {
      outline: none;
      border: 1px solid black;
    }

    .black {
      background: black;
      cursor: default;
      border: none;
    }

    .number {
      position: absolute;
      font-size: 10px;
      color: #000000;
      background:transparent;
      padding: 2px 4px;
      border-radius: 2px;
      z-index: 2000;
      font-weight: bold;
      line-height: normal;
    }

    .highlight {
      background: #add8e6 !important;
    }

    .selected {
      background: gold !important;
    }

    .correct {
      color: blue !important;
    }

    .error {
      background-image: linear-gradient(135deg, transparent 49%, red 49%, red 51%, transparent 51%) !important;
      background-repeat: no-repeat !important;
      background-size: 100% 100% !important;
    }

    .clue-box {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 12px;
      width: 350px;
      margin-top: 20px;
      background: #B0D6FB;
      padding: 12px 20px;
      border-radius: 0px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .clue-box button {
      background: none;
      border: none;
      color: black;
      font-size: 20px;
      font-weight: 500;
      cursor: pointer;
      padding: 16px;
      width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      transition: background-color 0.2s ease-in-out;
    }

    .clue-box button:hover {
      background: rgba(0, 0, 0, 0.1);
    }

    #clue {
      font-size: 16px;
      color: black;
      text-align: center;
      flex: 1;
      margin: 0;
    }

  </style>
</head>
<body>
    <div class="topbar">
        <a href="index.html">
          <img src="icons/nyt_logo.png" alt="Back" class="topbar-icon">
        </a>
        <div class="gear-container">
          <div class="gear">
            <img src="icons/gear.png" alt="Settings">
          </div>
          <div class="dropdown" id="dropdown">
            <div onclick="checkPuzzle()">Check Puzzle</div>
            <div onclick="checkWord()">Check Word</div>
            <div onclick="checkLetter()">Check Letter</div>
          </div>
        </div>
    </div>

    <div id="number-overlay"></div> <!-- Moved outside grid -->
    <div class="grid" id="grid"></div>

    <div class="clue-box">
      <button onclick="previousWord()">❮</button>
      <div id="clue"></div>
      <button onclick="nextWord()">❯</button>
    </div>

    <script>
      // === SOLUTION GRID ===
      const solution = [
        ["#", "#", "V", "O", "I"],
        ["#", "C", "A", "T", "S"],
        ["#", "A", "L", "T", "O"],
        ["B", "L", "U", "E", "#"],
        ["T", "I", "E", "R", "#"],
        ["C", "#", "#", "#", "#"]
      ];

      // === WORDS ===
      let words = [
        {number:1, dir:"across", cells:[[0,2],[0,3],[0,4]], clue:"Favourite Stockholm transportation."},
        {number:1, dir:"down", cells:[[0,2],[1,2],[2,2],[3,2],[4,2]], clue:"Worth of a shiny thing."},
        {number:2, dir:"down", cells:[[0,3],[1,3],[2,3],[3,3],[4,3]], clue:"Us when we sleep together (sing)."},
        {number:3, dir:"down", cells:[[0,4],[1,4],[2,4]], clue:"Three-letter code for uniformity worldwide."},
        {number:4, dir:"across", cells:[[1,1],[1,2],[1,3],[1,4]], clue:"Our cartoon alter egos."},
        {number:4, dir:"down", cells:[[1,1],[2,1],[3,1],[4,1]], clue:"Potential destination in USA after a few Swedish winters."},
        {number:5, dir:"across", cells:[[2,1],[2,2],[2,3],[2,4]], clue:"Mexican stop."},
        {number:6, dir:"across", cells:[[3,0],[3,1],[3,2],[3,3]], clue:"Me (Rodri) in 4-across."},
        {number:6, dir:"down", cells:[[3,0],[4,0],[5,0]], clue:"Controversial currency (abbr)."},
        {number:7, dir:"across", cells:[[4,0],[4,1],[4,2],[4,3]], clue:"Part of a wedding cake, one above another."}
      ];

      // Sort by number, then across before down
      words = words.sort((a, b) => a.number - b.number || (a.dir === "across" ? -1 : 1));

      const gridEl = document.getElementById("grid");
      const clueEl = document.getElementById("clue");
      const dropdown = document.getElementById("dropdown");
      const numberOverlay = document.getElementById("number-overlay");
      let selectedWordIndex = null;
      let selectedCellIndex = null;
      let currentR = -1;
      let currentC = -1;
      const cells = [];

      function handleAfterInput(r, c) {
        cells[r][c].classList.remove("error");
        if (selectedWordIndex !== null) {
          const word = words[selectedWordIndex];
          const [cr, cc] = word.cells[selectedCellIndex];
          if (cr === r && cc === c) {
            if (selectedCellIndex < word.cells.length - 1) {
              const nextIdx = selectedCellIndex + 1;
              const [nr, nc] = word.cells[nextIdx];
              selectWord(selectedWordIndex, nextIdx);
            } else {
              const nextWordIdx = (selectedWordIndex + 1) % words.length;
              selectWord(nextWordIdx, 0);
            }
          }
        }
      }

      function createGrid() {
        for (let r = 0; r < 6; r++) {
          cells[r] = [];
          for (let c = 0; c < 5; c++) {
            let cell;
            if (solution[r][c] === "#") {
              cell = document.createElement("div");
              cell.classList.add("cell", "black");
            } else {
              cell = document.createElement("input");
              cell.type = "text";
              cell.maxLength = 1;
              cell.classList.add("cell");
              cell.addEventListener("click", () => handleCellClick(r, c));
              cell.addEventListener("focus", () => handleCellFocus(r, c));
              cell.addEventListener("input", (e) => handleCellInput(e, r, c));
              cell.addEventListener("keydown", (e) => handleCellKeyDown(e, r, c));
              cell.addEventListener("select", (e) => e.preventDefault());
              cell.addEventListener("copy", (e) => e.preventDefault());
              cell.addEventListener("contextmenu", (e) => e.preventDefault());
              cell.addEventListener("dragstart", (e) => e.preventDefault());
            }
            gridEl.appendChild(cell);
            cells[r][c] = cell;
      
            cell.style.border = '1px solid #606060';
            if (c === 0) {
              cell.style.borderLeft = '2px solid black';
            }
            if (r === 0) {
              cell.style.borderTop = '2px solid black';
            }
            if (c === 4) {
              cell.style.borderRight = '2px solid black';
            }
            if (r === 5) {
              cell.style.borderBottom = '2px solid black';
            }
          }
        }
        // Add numbers to overlay
        const gridRect = gridEl.getBoundingClientRect();
        const bodyRect = document.body.getBoundingClientRect();
        const offsetX = gridRect.left - bodyRect.left;
        const offsetY = gridRect.top - bodyRect.top;
        words.forEach(w => {
          const [r, c] = w.cells[0];
          if (solution[r][c] !== "#") {
            const num = document.createElement("div");
            num.classList.add("number");
            num.textContent = w.number;
            // Position relative to grid's top-left corner
            num.style.left = `${offsetX + c * 60 + 2}px`;
            num.style.top = `${offsetY + r * 60 + 2}px`;
            numberOverlay.appendChild(num);
          }
        });
      }

      function handleCellClick(r, c) {
        const isCurrent = currentR === r && currentC === c && selectedWordIndex !== null;
        if (isCurrent) {
          const acrossIdx = words.findIndex(w => w.dir === "across" && w.cells.some(([wr, wc]) => wr === r && wc === c));
          const downIdx = words.findIndex(w => w.dir === "down" && w.cells.some(([wr, wc]) => wr === r && wc === c));
          if (acrossIdx !== -1 && downIdx !== -1) {
            const targetIdx = selectedWordIndex === acrossIdx ? downIdx : acrossIdx;
            const cellIdx = words[targetIdx].cells.findIndex(([wr, wc]) => wr === r && wc === c);
            selectWord(targetIdx, cellIdx);
            return;
          }
        }
        selectCellDefault(r, c);
      }

      function handleCellFocus(r, c) {
        if (currentR !== r || currentC !== c) {
          selectCellDefault(r, c);
        }
      }

      function handleCellInput(e, r, c) {
        const cell = cells[r][c];
        if (cell.classList.contains("correct")) {
          cell.value = solution[r][c];
          return;
        }

        let val = e.data ? e.data.toUpperCase() : e.target.value.toUpperCase();
        e.target.value = val.slice(-1);

        if (e.target.value.length === 1) {
          handleAfterInput(r, c);
        } else {
          e.target.classList.remove("error");
        }
      }

      function handleCellKeyDown(e, r, c) {
        const cell = cells[r][c];
        if (cell.classList.contains("correct")) {
          return;
        }

        if (e.key === "Backspace") {
          if (cell.value !== "") {
            cell.value = "";
            e.preventDefault();
          } else if (selectedWordIndex !== null && selectedCellIndex > 0) {
            const prevIdx = selectedCellIndex - 1;
            const [pr, pc] = words[selectedWordIndex].cells[prevIdx];
            selectWord(selectedWordIndex, prevIdx);
            cells[pr][pc].value = "";
            e.preventDefault();
          }
        } else if (/^[a-zA-Z]$/.test(e.key)) {
          const newVal = e.key.toUpperCase();
          cell.value = newVal;
          e.preventDefault();
          handleAfterInput(r, c);
        }
      }

      function selectCellDefault(r, c) {
        const acrossIdx = words.findIndex(w => w.dir === "across" && w.cells.some(([wr, wc]) => wr === r && wc === c));
        const downIdx = words.findIndex(w => w.dir === "down" && w.cells.some(([wr, wc]) => wr === r && wc === c));
        let chosenIdx = -1;
        if (acrossIdx !== -1) {
          chosenIdx = acrossIdx;
        } else if (downIdx !== -1) {
          chosenIdx = downIdx;
        }
        if (chosenIdx === -1) return;
        const cellIdx = words[chosenIdx].cells.findIndex(([wr, wc]) => wr === r && wc === c);
        selectWord(chosenIdx, cellIdx);
      }

      function selectWord(wordIndex, cellIndex = 0) {
        clearHighlights();
        selectedWordIndex = wordIndex;
        selectedCellIndex = cellIndex;
        const wordCells = words[wordIndex].cells;
        wordCells.forEach(([rr, cc]) => {
          const cell = cells[rr][cc];
          if (solution[rr][cc] !== "#") {
            cell.classList.add("highlight");
          }
        });
        const [sr, sc] = wordCells[cellIndex];
        currentR = sr;
        currentC = sc;
        const selCell = cells[sr][sc];
        selCell.classList.add("selected");
        if (selCell.tagName === "INPUT") {
          selCell.focus();
        }
        const dirLabel = words[wordIndex].dir === 'across' ? 'Across' : 'Down';
        clueEl.textContent = `${words[wordIndex].clue}`;
      }

      function clearHighlights() {
        for (let rr = 0; rr < 6; rr++) {
          for (let cc = 0; cc < 5; cc++) {
            if (solution[rr][cc] !== "#") {
              cells[rr][cc].classList.remove("highlight", "selected");
            }
          }
        }
      }

      function nextWord() {
        if (selectedWordIndex === null) {
          selectWord(0, 0);
        } else {
          const nextIdx = (selectedWordIndex + 1) % words.length;
          selectWord(nextIdx, 0);
        }
      }

      function previousWord() {
        if (selectedWordIndex === null) {
          const prevIdx = words.length - 1;
          selectWord(prevIdx, 0);
        } else {
          const prevIdx = (selectedWordIndex - 1 + words.length) % words.length;
          selectWord(prevIdx, 0);
        }
      }

      function checkPuzzle() {
        for (let r = 0; r < 6; r++) {
          for (let c = 0; c < 5; c++) {
            if (solution[r][c] === "#") continue;
            const cell = cells[r][c];
            cell.classList.remove("correct", "error");
            const val = cell.value;
            if (val === solution[r][c]) {
              cell.classList.add("correct");
            } else if (val !== "") {
              cell.classList.add("error");
            }
          }
        }
      }

      function checkWord() {
        if (selectedWordIndex === null) return;
        const wcells = words[selectedWordIndex].cells;
        wcells.forEach(([r, c]) => {
          const cell = cells[r][c];
          cell.classList.remove("correct", "error");
          const val = cell.value;
          if (val === solution[r][c]) {
            cell.classList.add("correct");
          } else if (val !== "") {
            cell.classList.add("error");
          }
        });
      }

      function checkLetter() {
        if (selectedWordIndex === null || selectedCellIndex === null) return;
        const [r, c] = words[selectedWordIndex].cells[selectedCellIndex];
        const cell = cells[r][c];
        cell.classList.remove("correct", "error");
        const val = cell.value;
        if (val === solution[r][c]) {
          cell.classList.add("correct");
        } else if (val !== "") {
          cell.classList.add("error");
        }
      }

      document.querySelector(".gear").addEventListener("click", () => {
        dropdown.style.display = dropdown.style.display === "block" ? "none" : "block";
      });

      createGrid();
    </script>
</body>
</html>