<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Connections</title>
  <style>
    body {
      font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
      background: #f8f9fa;
      margin: 0;
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    h1 {
      font-weight: 400;
      font-size: 15px;
      margin-bottom: 20px;
      color: #515043;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(4, 100px);
      grid-auto-rows: 100px;
      gap: 10px;
      width: max-content;
      position: relative;
    }
    .tile {
      background: #EFEFE6;
      border-radius: 8px;
      display: flex;
      justify-content: center;
      align-items: center;
      text-align: center;
      font-size: 14px;
      font-weight: 580;
      cursor: pointer;
      transition: background 0.2s, transform 0.2s;
      user-select: none;
    }
    .tile.selected {
      background: #59594E;
      color: #F8F8F8;
      transform: scale(1.05);
    }
    .tile.correct {
      cursor: default;
      color: white;
    }

    .group-yellow { background: #fbe48c; }  /* warm pastel yellow */
    .group-green  { background: #9dd296; }  /* minty pastel green */
    .group-blue   { background: #91b9e3; }  /* soft sky blue */
    .group-purple { background: #c5a3d8; }  /* gentle lilac */

    /* Shake animation */
    @keyframes shake {
      0%   { transform: translateX(0); }
      10%  { transform: translateX(-5px); }
      20%  { transform: translateX(5px); }
      30%  { transform: translateX(-5px); }
      40%  { transform: translateX(5px); }
      50%  { transform: translateX(-5px); }
      60%  { transform: translateX(5px); }
      70%  { transform: translateX(-5px); }
      80%  { transform: translateX(5px); }
      90%  { transform: translateX(-5px); }
      100% { transform: translateX(0); }
    }
    .tile.shake {
      animation: shake 1s;
    }

    /* Lives */
    .lives-container {
      display: flex;
      align-items: center;
      margin: 20px 0;
      gap: 10px;
    }
    .lives-label {
      font-weight: 400;
      font-size: 15px;
      color: #515043;
    }
    .lives {
      display: flex;
      gap: 8px;
    }
    .life {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      border: 2px solid #59594E;
      background: #59594E;
    }
    .life.shrink {
      animation: shrinkOut 0.4s forwards;
    }
    @keyframes shrinkOut {
      0% { transform: scale(1); opacity: 1; }
      100% { transform: scale(0); opacity: 0; }
    }

    /* Buttons */
    .actions {
      display: flex;
      gap: 15px;
      margin-top: 10px;
    }
    .btn {
      padding: 10px 20px;
      border: 1px solid #333;
      border-radius: 25px;
      background: white;
      cursor: pointer;
      font-weight: bold;
      transition: background 0.2s, transform 0.2s;
    }
    .btn:hover {
      background: #e9ecef;
      transform: scale(1.05);
    }
    .btn:disabled {
      background: #f0f0f0;
      color: #999;
      border-color: #ccc;
      cursor: not-allowed;
    }

    /* Long fused tile */
    .long-tile {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      border-radius: 8px;
      color: black;
      font-size: 14px;
      font-weight: bold;
      grid-column: span 4;
      padding: 5px;
      transform: translateY(-10px);
      opacity: 0;
      transition: transform 0.5s ease-out, opacity 0.5s ease-out;
    }
    .long-tile.show {
      transform: translateY(0);
      opacity: 1;
    }
    .long-tile .subtitle {
      font-weight: 400;
      font-size: 14px;
      text-align: center;
    }
  </style>
</head>
<body>
  <h1>Create four groups of four!</h1>
  <div class="grid" id="grid"></div>
  
  <div class="lives-container">
    <div class="lives-label">Mistakes remaining:</div>
    <div class="lives" id="lives"></div>
  </div>
  
  <div class="actions">
    <button class="btn" onclick="shuffleTiles()">Shuffle</button>
    <button class="btn" onclick="deselectAll()">Deselect All</button>
    <button class="btn" id="submitBtn" onclick="submitSelection()">Submit</button>
  </div>
  
  <div id="message" style="margin-top:15px; font-weight:bold;"></div>

  <script>
    const categories = [
      { name: "COMBINED WITH SARA, THEY MAKE A NICKNAME", color: "group-yellow", words: ["BACÍN", "HEVO", "WARMA", "AMPION"] },
      { name: "DATES THAT WE WHERE ON (WHEN WE WERE NOT DATING)", color: "group-green", words: ["SUSHI", "TAYLOR", "ROOFTOP", "ICE SKATING"] },
      { name: "NORWAY ROADTRIP STARTER PACK", color: "group-blue", words: ["XC60", "WIPES", "MARSHMALLOWS", "MINK"] },
      { name: "RHYMES WITH GOTHENBURG FRIENDS", color: "group-purple", words: ["CHÂTEAU", "KOREAN", "DILEMMA", "CHIA"] }
    ];

    let words = categories.flatMap(c => c.words).sort(() => Math.random() - 0.5);
    const grid = document.getElementById("grid");
    const message = document.getElementById("message");
    const livesContainer = document.getElementById("lives");
    let selected = [];
    let mistakes = 4;
    let solvedGroups = 0;
    let fusedTiles = [];

    function renderLives() {
      livesContainer.innerHTML = "";
      for (let i = 0; i < mistakes; i++) {
        const circle = document.createElement("div");
        circle.className = "life";
        livesContainer.appendChild(circle);
      }
    }
    renderLives();

    function loseLife() {
      const circles = livesContainer.querySelectorAll(".life");
      if (circles.length > 0) {
        const lastLife = circles[circles.length - 1];
        lastLife.classList.add("shrink");
        lastLife.addEventListener("animationend", () => {
          lastLife.remove();
        }, { once: true });
      }
    }

    function renderGrid() {
      grid.innerHTML = "";
      fusedTiles.forEach(tile => grid.appendChild(tile));
      words.forEach(word => {
        const div = document.createElement("div");
        div.classList.add("tile");
        div.textContent = word;
        div.onclick = () => toggleSelect(div);
        grid.appendChild(div);
        adjustFont(div);
      });
    }

    function toggleSelect(tile) {
      if (tile.classList.contains("correct")) return;
      if (selected.includes(tile)) {
        tile.classList.remove("selected");
        selected = selected.filter(t => t !== tile);
      } else if (selected.length < 4) {
        tile.classList.add("selected");
        selected.push(tile);
      }
    }

    function deselectAll() {
      selected.forEach(t => t.classList.remove("selected"));
      selected = [];
    }

    function shuffleTiles() {
      words = words.sort(() => Math.random() - 0.5);
      renderGrid();
      deselectAll();
    }

    function adjustFont(tile) {
      let fontSize = 14;
      const minFont = 8;
      tile.style.fontSize = fontSize + "px";
      while ((tile.scrollWidth > tile.clientWidth || tile.scrollHeight > tile.clientHeight) && fontSize > minFont) {
        fontSize -= 1;
        tile.style.fontSize = fontSize + "px";
      }
    }

    function submitSelection() {
      if (selected.length !== 4) {
        return;
      }
      const wordsChosen = selected.map(t => t.textContent);
      const foundCategory = categories.find(cat =>
        cat.words.every(w => wordsChosen.includes(w))
      );

      if (foundCategory) {
        words = words.filter(w => !wordsChosen.includes(w));

        const longTile = document.createElement("div");
        longTile.className = "long-tile " + foundCategory.color;
        longTile.innerHTML = `<div class="title">${foundCategory.name}</div>
                              <div class="subtitle">${foundCategory.words.join(", ")}</div>`;
        fusedTiles.push(longTile);

        renderGrid();

        adjustFont(longTile.querySelector(".subtitle"));

        setTimeout(() => longTile.classList.add("show"), 50);

        solvedGroups++;

        if (solvedGroups === 4) {
          document.getElementById("submitBtn").disabled = true;
        }

        deselectAll();
      } else {
        mistakes--;
        loseLife();
        selected.forEach(tile => {
          tile.classList.add("shake");
          tile.addEventListener("animationend", () => {
            tile.classList.remove("shake");
          }, { once: true });
        });
        if (mistakes === 0) {
            categories.map(c => `${c.name}: ${c.words.join(", ")}`).join("\n");
          document.getElementById("submitBtn").disabled = true;
        }
        deselectAll();
      }
    }

    renderGrid();
  </script>
</body>
</html>
<!-- include feature of one away --> 
<!-- filling of buttons should invert colors -->
<!-- mistakes + lifes should not shift-->